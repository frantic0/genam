# Generative Acoustic Metamaterial

__genam__ is a python package and a framework for the generative design and optimisation of acoustic metamaterials.



<br />

## Dependencies 

__genam__ scripts run on Salome's Python virtual environment. 

* [Salome 9.8.0](https://salome-platform.org/) – Integration platform for numerical simulation

That means that, rather than executing __genam__ scripts using your Python installation on your terminal, shell or integrated development environment (IDE, e.g. VS Code, Atom or Pylance), you need to run them with Salome. Next section will show how to open scripts on Salome's graphical user interface, or run them with Salome in batch mode in the command line interface. 

The following is the list of other software necessary to run __genam__ scripts:

* [ElmerFEM](http://www.csc.fi/elmer) – Multiphysical simulation
* [Paraview](https://www.paraview.org/) – Data analysis and visualization 
* [Python 3.9](https://www.python.org/) and libraries for post-processing and analysis:
  * [numpy](https://www.python.org/)
  * [pandas](https://www.python.org/)
  * [matplotlib](https://www.python.org/)
  * [meshio](https://www.python.org/)
  * [pytorch](https://pytorch.org)

Additionally, you may want to install Jupiter notebooks to run interactive analyis

* [Jupyter Notebooks](https://www.python.org/)

You will need an IDE or code editor to edit the Python code in your scripts. Here's is a useful thread to set up a code editor with Salome.

[Using python salome libraries from a python IDE](https://discourse.salome-platform.org/t/using-python-salome-libraries-from-a-python-ide/63/7)

<br />
### Installation

We suggest you unpack Salome to 

```
C:\SALOME-9.8.0
```

Once you have unpacked Salome to this directory, you will find there the following scripts:

* Linux: source ```env_launch.sh``` (generated by ./sat environ SALOME)
* Windows: ```env_launch.bat``` (shipped with SALOME).

You will need to run these to set Salome's virtual environment to install the Python module dependencies listed above. To do so, go 




<br />

## Up and Running


Once you have everything set up can set

Start a Salome instance

```
python salome
```



that will generate the labyrinthine brick's geometry and . 


Generate .unv and Elmer .sif template for for labyrinthine brick #15 

```
python .\salome -t -w1 
```

### Command Line Interface
You can also use salome in batch mode



Generate .unv and Elmer .sif template for all labyrinthine bricks

```
python '..\..\..\..\..\SALOME-9.8.0\salome' shell -p 2819 
.\process_geometry.py args:15,40000,41000,1000 
.\process_geometry.py args:14,40000,41000,1000 
.\process_geometry.py args:13,40000,41000,1000 
.\process_geometry.py args:12,40000,41000,1000 
.\process_geometry.py args:11,40000,41000,1000 
.\process_geometry.py args:10,40000,41000,1000 
.\process_geometry.py args:9,40000,41000,1000 
.\process_geometry.py args:8,40000,41000,1000 
.\process_geometry.py args:7,40000,41000,1000 
.\process_geometry.py args:6,40000,41000,1000 
.\process_geometry.py args:5,40000,41000,1000 
.\process_geometry.py args:4,40000,41000,1000 
.\process_geometry.py args:3,40000,41000,1000 
.\process_geometry.py args:2,40000,41000,1000 
.\process_geometry.py args:1,40000,41000,1000
```


Generate .unv and Elmer .sif template first and then and Elmer solver for labyrinthine brick #15 to generate a .vtu file  

```
python ..\..\..\..\..\SALOME-9.8.0\salome shell -p 2821 .\process_geometry.py args:15,40000,41000,500 .\run_elmer_solver.py args:15
```


Generate .unv and Elmer .sif template first and then and Elmer solver for all labyrinthine bricks to generate a .vtu file

```
import sys
from pathlib import Path

### Salome GEOM and SMESH components
import salome
salome.salome_init()
```

```
# Set file paths for library and tests  
# TODO: find a way to remove this into dependant classes as platform-dependent relative paths 
sys.path.insert(0, r'C:/Users/francisco/Documents/dev/pipeline')
sys.path.insert(0, r'C:/Users/francisco/Documents/dev/pipeline/genam')
sys.path.insert(0, r'C:/Users/francisco/Documents/dev/pipeline/tests')
```

```
# Genam Lens, mesh configurator
from genam.lens import Lens
from genam.lens_configuration import lens_configurator 
from genam.mesh_configuration import selector as mesh_config_selector
from matrices.quantized_1_1 import quantized_matrix_1_1
from genam.utility_functions import convert_mesh, copy_solver_templates
```

```
lens_config = lens_configurator( quantized_matrix_1_1 )
```


```
lens_name = 'quantized_matrix_1_1' 

# Create lens with name, bricks ID and mesh configurations 

lens = Lens( lens_config, mesh_config_selector(3), name = lens_name  )

lens.process_geometry() # Create the lens geometry 

lens.process_mesh() # Create lens mesh 
```


```
# define a path where all data will be stored (.unv mesh file, solver *.mesh files, sif. file )
path = str(Path('C:/Users/francisco/Documents/acoustic-brick/').joinpath( lens_name + '.unv')) 

lens.export_mesh( path ) # export .unv mesh file

convert_mesh( path ) # run elmergrid convert .unv mesh file to elmer format *.mesh files in a directory 

# copy all the necessary templates to run elmer solver
copy_solver_templates(  path, 
                        start_frequency = 40000, 
                        end_frequency = 41000, 
                        step = 1000 )

```
